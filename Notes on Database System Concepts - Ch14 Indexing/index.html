<!DOCTYPE html>













<html class="theme-next muse" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>


  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"/>



  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1.0.2/themes/blue/pace-theme-minimal.css"/>





  <meta http-equiv="Cache-Control" content="no-transform"/>
  <meta http-equiv="Cache-Control" content="no-siteapp"/>



  <meta name="google-site-verification" content="true"/>







  <meta name="baidu-site-verification" content="vh3BWN1atu" />



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/fancybox@3.0.0/dist/css/jquery.fancybox.min.css"/>







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"/>

<link rel="stylesheet" href="/css/main.css?v=7.0.1"/>



  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=7.0.1">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  



<script type="text/javascript">
  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//st.flyhigher.top/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>

  <meta name="description" content="[TOC] Ch14 IndexingMany queries reference only a small proportion of records, like where condition, it’s insufficient to read every tuple. Ideally, it shall be able to locate these records directly. 1">
<meta property="og:type" content="article">
<meta property="og:title" content="Notes on Database System Concepts - Ch14 Indexing">
<meta property="og:url" content="https://www.virgilsun.com/Notes%20on%20Database%20System%20Concepts%20-%20Ch14%20Indexing/index.html">
<meta property="og:site_name" content="Sun&#39;s Blog">
<meta property="og:description" content="[TOC] Ch14 IndexingMany queries reference only a small proportion of records, like where condition, it’s insufficient to read every tuple. Ideally, it shall be able to locate these records directly. 1">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2021/12/07/yJPiOeaF9CGTu2t.png">
<meta property="og:image" content="https://s2.loli.net/2021/12/09/iSuQFqBr74lIvjh.png">
<meta property="article:published_time" content="2021-12-05T16:00:00.000Z">
<meta property="article:modified_time" content="2021-12-09T03:15:25.741Z">
<meta property="article:author" content="Virgil Sun">
<meta property="article:tag" content="Indexing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2021/12/07/yJPiOeaF9CGTu2t.png">



  <link rel="alternate" href="/atom.xml" title="Sun's Blog" type="application/atom+xml"/>



  
  
  <link rel="canonical" href="https://www.virgilsun.com/Notes%20on%20Database%20System%20Concepts%20-%20Ch14%20Indexing/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Notes on Database System Concepts - Ch14 Indexing | Sun's Blog</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?db5a55d89cc89dd77ff08de18d30e45f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sun's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Goose had left marks.</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>Tags<span class="badge">26</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br/>Categories<span class="badge">3</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>Archives<span class="badge">17</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-13/36">

    
    
    
      
    

    
      
    

    <a href="/sentence" rel="section"><i class="menu-item-icon fa fa-fw fa-align-left"></i> <br/>13/36</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br/>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/SwJay" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.virgilsun.com/Notes%20on%20Database%20System%20Concepts%20-%20Ch14%20Indexing/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Virgil Sun"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="https://i.loli.net/2019/04/02/5ca34b140d93c.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sun's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Notes on Database System Concepts - Ch14 Indexing

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-12-06 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-06T00:00:00+08:00">2021-12-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2021-12-09 11:15:25" itemprop="dateModified" datetime="2021-12-09T11:15:25+08:00">2021-12-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/Notes%20on%20Database%20System%20Concepts%20-%20Ch14%20Indexing/" class="leancloud_visitors" data-flag-title="Notes on Database System Concepts - Ch14 Indexing">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                
                  
                    
                  
                
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>[TOC]</p>
<h1 id="Ch14-Indexing"><a href="#Ch14-Indexing" class="headerlink" title="Ch14 Indexing"></a>Ch14 Indexing</h1><p>Many queries reference only a small proportion of records, like where condition, it’s insufficient to read every tuple. Ideally, it shall be able to locate these records directly.</p>
<h2 id="14-1-Basic-Concepts"><a href="#14-1-Basic-Concepts" class="headerlink" title="14.1 Basic Concepts"></a>14.1 Basic Concepts</h2><p>Two basic kindes of indices:</p>
<ul>
<li>Order indices: Based on a sorted ordering of the value</li>
<li>Hash indices: Based on a uniformly distribution of value across a range of buckets.</li>
</ul>
<p>No one technique is the best. Rather, each technique is best suited to particular database applications. Each technique must be evaluated on the basis of these factors:</p>
<ul>
<li>Access types: E.g. point query, range query.</li>
<li>Access time.</li>
<li>Insertion time: time to find the corect location to insert new item, and time to update the index structure.</li>
<li>Deletion time: time to find the item to be deleted, and time to update the index structure.</li>
<li>Space overhead.</li>
</ul>
<p>We often want to have more than one index for a ﬁle on different attributes.</p>
<h2 id="14-2-Ordered-Indices"><a href="#14-2-Ordered-Indices" class="headerlink" title="14.2 Ordered Indices"></a>14.2 Ordered Indices</h2><p><strong>index entry</strong>: a search-key value + pointers to one or more records with that value as their search-key value.</p>
<ul>
<li><p>primary vs. secondary index</p>
<ul>
<li><p><strong>clustering index</strong> (<strong>primary index</strong>): search key also defines the sequential order of the file (<strong>index-sequential file</strong>).</p>
</li>
<li><p><strong>nonclustering index</strong> (<strong>secondary index</strong>): search key speciﬁes an order diﬀerent from the sequential order of the ﬁle.</p>
</li>
</ul>
</li>
</ul>
<h3 id="14-2-1-Dense-and-Sparse-Indices"><a href="#14-2-1-Dense-and-Sparse-Indices" class="headerlink" title="14.2.1 Dense and Sparse Indices"></a>14.2.1 Dense and Sparse Indices</h3><ul>
<li>dense vs. sparse index<ul>
<li><strong>dense index</strong>: an index entry appears for every search-key value in the file.<ul>
<li>In a dense clustering index, the index entry contains one pointer to the first record with that search-key value, where the rest records are stored sequentially after it.</li>
<li>In a dense nonclustering index, the index entry must store a list of pointers to all records with the same search-key value.</li>
</ul>
</li>
<li><strong>sparse index</strong>: an index entry appears for only some of the searchkey values. Sparse indices can be used only if the relation is stored in sorted order of the search key; that is, if the index is a clustering index.</li>
<li>pros:<ul>
<li>dense index: faster access time</li>
<li>sparse index: less space, less maintenance cost for insertions and deletions.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>It’s a trade off between access time and space overhead. A good compromise is to have a sparse index with one index entry per block since the dominant cost in processing a database request is the time that it takes to bring a block from disk into main memory. Once we have brought in the block, the time to scan the entire block is negligible.</p>
<p>However, if the record is in overflow block, it takes extra block access.</p>
<h3 id="14-2-2-Multilevel-Indices"><a href="#14-2-2-Multilevel-Indices" class="headerlink" title="14.2.2 Multilevel Indices"></a>14.2.2 Multilevel Indices</h3><p>Index file can also be too large to fit in the memory thus requiring loading from disk. Binary search can be used on the index file to locate the entry, but the search still has a large cost $\lceil\log_2(b)\rceil$, where $b$ denotes # blocks the index occupies.</p>
<p>Building multilevel indices with $m$ fan-out, can reduce to $\lceil\log_m(b)\rceil$. Note that the index entries are always in sorted order, allowing the outer index to be sparse.</p>
<h3 id="14-2-3-Index-Update"><a href="#14-2-3-Index-Update" class="headerlink" title="14.2.3 Index Update"></a>14.2.3 Index Update</h3><p>Treat update as deletion and insertion. For index-sequential files.</p>
<h4 id="14-2-3-1-Insertion"><a href="#14-2-3-1-Insertion" class="headerlink" title="14.2.3.1 Insertion"></a>14.2.3.1 Insertion</h4><p>First, the system performs a lookup using the search-key value that appears in the record to be inserted.</p>
<ul>
<li>Dense indices<ol>
<li>If the search-key value doesn’t appear in the index, inserts an index entry at the appropriate position.</li>
<li>Else (index already has this search-key value)<ol>
<li>If the index entry stores pointers to all records with the same search-key, adds a new pointer to the new record.</li>
<li>Else if the index entry only stores a pointer to the first record, place the new record after other records with the same value.</li>
</ol>
</li>
</ol>
</li>
<li>Sparse indices: Assume the index stores an entry for each block.<ol>
<li>If a new block is created: insert the first search-key value in the new block into the index</li>
<li>If the new record update the least search-key in its block: update the index entry</li>
<li>Else, no change.</li>
</ol>
</li>
</ul>
<h4 id="14-2-3-2-Deletion"><a href="#14-2-3-2-Deletion" class="headerlink" title="14.2.3.2 Deletion"></a>14.2.3.2 Deletion</h4><p>To delete a record, the system ﬁrst looks up the record to be deleted.</p>
<ul>
<li>Dense indices<ol>
<li>the deleted record is the only record with this search-key value</li>
<li>Else (multiple records with this search-key value)<ol>
<li>If the entry stores pointers to all records: delete the pointer to the record to be deleted.</li>
<li>Else if the entry only stores a pointer to the first record: only update this index entry when the record to be deleted is the first record, and point to the second one.</li>
</ol>
</li>
</ol>
</li>
<li>Sparse indices<ol>
<li>If index doesn’t contain any entry with the search key value of the deleted record: no change.</li>
<li>Else (appear in entry)<ol>
<li>If the deleted record is the only record with its search key: replace the index record with an index record with the next search-key value; if the next already has index entry, just delete instead of being replaced.</li>
<li>Else (multiple records with same search-key): update to the second record with same key.</li>
</ol>
</li>
</ol>
</li>
</ul>
<h3 id="14-2-4-Secondary-Indices"><a href="#14-2-4-Secondary-Indices" class="headerlink" title="14.2.4 Secondary Indices"></a>14.2.4 Secondary Indices</h3><p>Secondary indices must be dense, with an index entry for every search-key value, and a pointer to every record in the ﬁle. </p>
<ul>
<li>On a candidate key:<ul>
<li>like a dense clustering index, bur records are not sequentially stored.</li>
</ul>
</li>
<li>Not a candidate key:<ul>
<li><strong>nonunique search key</strong>: If a relation can have more than one record containing the same search key value.</li>
<li>One implementation: the secondary index entry contains a pointer to a bucket that contain pointers to those records.<ul>
<li>Drawbacks:<ul>
<li>Longer access time: since it introduces an extra level of indirection.</li>
<li>May waste space: If a key has few/no duplicates, if a bucket is assigned with a whole block.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Sequential scan in secondary-key order can be low.</p>
<p>Insertion and deletion in Ch14.2.3 applies to secondary index with actions for dense indices storing pointers for all records.</p>
<p>Secondary indices improve the performance of queries with keys other than the clustering index, but impose a significant overhead on modification. Deciding which secondary indices are desirable should be based on estimation of the relative frequency of queries and modifications.</p>
<h3 id="14-2-5-Indices-on-Multiple-Keys"><a href="#14-2-5-Indices-on-Multiple-Keys" class="headerlink" title="14.2.5 Indices on Multiple Keys"></a>14.2.5 Indices on Multiple Keys</h3><p><strong>composite search key</strong>: A search key containing more than one attribute.</p>
<p><strong>lexicographic ordering</strong>: Determine orderings for composite search key, i.e. a tuple of values .For example, for the case of two attribute search keys, $(a_1, a_2 ) &lt; (b_1, b_2)$ if either $a_1 &lt; b_1$ or $a_1 = b_1$ and $a_2 &lt; b_2$.</p>
<h2 id="14-3-B-Tree-Index-Files"><a href="#14-3-B-Tree-Index-Files" class="headerlink" title="14.3 B+-Tree Index Files"></a>14.3 B+-Tree Index Files</h2><p><strong>B+-tree index</strong></p>
<ul>
<li>balanced tree: every path from the root to a leaf is of equal length</li>
<li>nonleaf node<ul>
<li>other than the root: has between $\lceil n/2 \rceil$ and $n$ children, where $n$ is fixed for a particular tree.</li>
<li>root: has between $2$ and $n$ children.</li>
</ul>
</li>
</ul>
<p>cons: extra insertion and deletion overhead, space overhead. But the advantages of B+-tree outweigh disadvantages.</p>
<h3 id="14-3-1-Structure-of-a-B-Tree"><a href="#14-3-1-Structure-of-a-B-Tree" class="headerlink" title="14.3.1 Structure of a B+-Tree"></a>14.3.1 Structure of a B+-Tree</h3><p>Assume no duplicate search key values; we consider the issue of nonunique search keys later.</p>
<p><strong>Node structure</strong></p>
<ul>
<li>$n-1$ search-key values $K_1,K_2,…,K_{n-1}$: in sorted order</li>
<li>$n$ pointers $P_1,P_2,…,P_n$</li>
</ul>
<p><img src="https://s2.loli.net/2021/12/07/yJPiOeaF9CGTu2t.png" alt="B+tree_node"></p>
<p><strong>Leaf node</strong></p>
<ul>
<li>Search-key values<ul>
<li>Each leaf node can have between $\lceil (n-1)/2 \rceil$ and $n-1$ search-key values</li>
<li>For 2 leaf nodes $L_i, L_j$ where $i&lt;j$, then every search-key value in $L_i$ is smaller than every search-key value in $L_j$.</li>
</ul>
</li>
<li>Pointers:<ul>
<li>$P_i$, where $i=1,2,…,n-1$, points to a file record with search-key value $K_i$.</li>
<li>$P_n$ points to the next leaf node thus forming a chain in search-key order.</li>
</ul>
</li>
</ul>
<p><strong>Nonleaf node</strong> (<strong>internal node</strong>)</p>
<ul>
<li>Pointers<ul>
<li>$P_i$ points to tree nodes containing those search-key values  $[K_{i-1},K_i)$. In other words, $K_i$ equals to the minimal value in the part pointed by $P_{i+1}$.</li>
<li>a nonleaf node has between $\lceil n/2 \rceil$ and $n$ pointers.</li>
<li><em>fanout</em>: # pointers in a node</li>
</ul>
</li>
</ul>
<p>To solve duplicated serach-key value, can have pointers for every record or point to a bucket. Most DB implementations solve nonuniqueness by coupling with the primary key: if search key $a_i$ of relation $r$ is nonunique, let $A_i$ be the primary key, use $(a_i,A_i)$ instead of $a_i$ as search key.</p>
<h3 id="14-3-2-Queries-on-B-Trees"><a href="#14-3-2-Queries-on-B-Trees" class="headerlink" title="14.3.2 Queries on B+-Trees"></a>14.3.2 Queries on B+-Trees</h3><p><strong>point query</strong>: all the way down leaf node, and point to the file record.</p>
<p>B+-tree supports <strong>range query</strong> on $[lb,ub]$, by point query $lb$, and traverse on leaf nodes until $ub$.</p>
<p>Query cost</p>
<ul>
<li>root to leaf: If there are N records in the ﬁle, the path is no longer than $\lceil \log_{\lceil n/2 \rceil} (N) \rceil$.<ul>
<li>Difference between B+-tree and in-memory tree (such as binary tree): size of a node (Fanout), and as a result, the height of the tree.</li>
</ul>
</li>
<li>leaf query:<ul>
<li>point query: 1 more random I/O operation</li>
<li>range query:<ul>
<li>cost to fetch multiple leaf nodes</li>
<li>cost to access file block, cost depends on whether it’s a index-sequential file.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>To avoid duplication, the same as in Ch14.3.1 with composite keys as $(a_i, A_i)$. Issue: how to query all records for a certain value $a_i=v$? Solution: use range query on $[(v,-\infty), (v, \infty)]$.</p>
<h3 id="14-3-3-Updates-on-B-Trees"><a href="#14-3-3-Updates-on-B-Trees" class="headerlink" title="14.3.3 Updates on B+-Trees"></a>14.3.3 Updates on B+-Trees</h3><p>Consider only insertion and deletion, which may cause to <strong>split</strong> a node or <strong>coalesce</strong> nodes.</p>
<h4 id="14-3-3-1-Insertion"><a href="#14-3-3-1-Insertion" class="headerlink" title="14.3.3.1 Insertion"></a>14.3.3.1 Insertion</h4><p>If a leaf node is already full, after insertion it shall be splitted. a new leaf node should create a new entrey in its parent node, and may cause spliting in cascade.</p>
<h4 id="14-3-32-Deletion"><a href="#14-3-32-Deletion" class="headerlink" title="14.3.32 Deletion"></a>14.3.32 Deletion</h4><p>If after deletion, # search keys in the leaf node $&lt;\lceil (n-1)/2 \rceil$, either merge the node with a sibling node or redistribute the entries between the nodes, to ensure that each node is at least half-full.</p>
<h3 id="14-3-4-Complexity-of-B-Tree-Updates"><a href="#14-3-4-Complexity-of-B-Tree-Updates" class="headerlink" title="14.3.4 Complexity of B+-Tree Updates"></a>14.3.4 Complexity of B+-Tree Updates</h3><p>Insertion and deletion operations arecomplicated, they require relatively few I/O operations.</p>
<h2 id="14-4-B-Tree-Extensions"><a href="#14-4-B-Tree-Extensions" class="headerlink" title="14.4 B+-Tree Extensions"></a>14.4 B+-Tree Extensions</h2><h3 id="14-4-1-B-Tree-File-Organization"><a href="#14-4-1-B-Tree-File-Organization" class="headerlink" title="14.4.1 B+-Tree File Organization"></a>14.4.1 B+-Tree File Organization</h3><p>As mentioned in Section 14.3, the main drawback of index-sequential ﬁle organization is the degradation of performance as the ﬁle grows: With growth, an increasing percentage of index entries and actual records become out of order and are stored in overﬂow blocks. We solve the degradation of index lookups by using B+-tree indices on the ﬁle.</p>
<p><strong>B+-tree file organization</strong></p>
<ul>
<li>leaf node: store records, instead of storing pointers to records.</li>
</ul>
<h3 id="14-4-2-Secondary-Indices-and-Record-Relocation"><a href="#14-4-2-Secondary-Indices-and-Record-Relocation" class="headerlink" title="14.4.2 Secondary Indices and Record Relocation"></a>14.4.2 Secondary Indices and Record Relocation</h3><p>Some ﬁle organizations, such as the B + -tree ﬁle organization, may change the location of records even when the records have not been updated like spliting and coalescing.</p>
<p>A widely used solution for this problem is as follows: In secondary indices, in place of pointers to the indexed records, we store the values of the primary-index search-key attributes.</p>
<p>Thus relocation of records doesn’t requrie updates on secondary indices. And the query on secondary index now requires 2 steps: query secondary index to find primary key, query parimary index to locate record.</p>
<h3 id="14-4-3-Indexing-Strings"><a href="#14-4-3-Indexing-Strings" class="headerlink" title="14.4.3 Indexing Strings"></a>14.4.3 Indexing Strings</h3><p>Creating B + -tree indices on string-valued attributes raises two problems:</p>
<ol>
<li>Strings can be of variable length, thus nodes may have different fanouts.</li>
<li>Strings can be long, leading to a low fanout and a correspondingly increased tree height.</li>
</ol>
<p>To increase the fanout, use <strong>prefix compression</strong>, i.e. don’t store entire search-key value at nonleaf nodes but only a prefix that is sufficient to distinguish between the key values in the subtree.</p>
<h3 id="14-4-4-Bulk-Loading-of-B-Tree-Indices"><a href="#14-4-4-Bulk-Loading-of-B-Tree-Indices" class="headerlink" title="14.4.4 Bulk Loading of B+-Tree Indices"></a>14.4.4 Bulk Loading of B+-Tree Indices</h3><p><strong>bulk loading</strong>: Insertion of a large number of entries at a time into an index.</p>
<p>Solution:</p>
<ol>
<li>Create flat file containing index entries.</li>
<li>Sort the file on the search-key of the index being constructed.</li>
<li>Scan the sorted file and insert into the index.</li>
</ol>
<p>There is a signiﬁcant beneﬁt to sorting the entries before inserting them into the B +-tree. When the entries are inserted in sorted order, all entries that go to a particular leaf node will appear consecutively, and the leaf needs to be written out only once; nodes will never have to be read from disk during bulk load, if the B + -tree was empty to start with.</p>
<p><strong>bottom-up B +tree construction</strong>: If the B + -tree is initially empty, it can be constructed faster by building it bottom-up, from the leaf level, instead of using the usual insert procedure. After sorting the entries as we just described, we break up the sorted entries into blocks, keeping as many entries in a block as can ﬁt in the block; the resulting blocks form the leaf level of the B +-tree.</p>
<p>Some database systems recommend that if a very large number of tuples are added at once to an already existing relation, indices on the relation (other than any index on the primary key) should be dropped, and then re-created after the tuples are inserted, to take advantage of eﬃcient bulk-loading techniques.</p>
<h3 id="14-4-6-Indexing-on-Flash-Storage"><a href="#14-4-6-Indexing-on-Flash-Storage" class="headerlink" title="14.4.6 Indexing on Flash Storage"></a>14.4.6 Indexing on Flash Storage</h3><p>:star:Flash storage is different on writting, which inspires works like LSM tree to reduce erase operations for flash storage.</p>
<ul>
<li>Flash storage is structred as pages: smaller than magnetic blocks</li>
<li>Faster random page read: 20 to 100 microseconds, while 5 to 10 miliseconds with magnetic disk</li>
<li>Complicated writing operation, heavy cost for <strong>eration operation</strong>: Flash storage doesn’t permit in-placeupdates to data at the physical level. It’s a copy+write of an entire flash-storage page, requiring the old copy of the page to be erased subsequently. A new page can be written in 20 to 100 microseconds, but eventually old pages need to be erased to free up the pages for further writes. :question:Erases are done at the level of blocks containing multiple pages, and a block erase takes 2 to 5 milliseconds.</li>
</ul>
<p>Optimum B+-tree node for flash is smaller than magnetic disk. It makes sense for node size to match  page size.</p>
<p>Several extensions and alternatives to B+-tree have been proposed for flash storage</p>
<ul>
<li>target: reducing the number of erase operations that result due to page rewrites.</li>
<li>solutions (Ch14.8):<ol>
<li>add buﬀers to internal nodes of B +-trees and record updates temporarily in buﬀers at higher levels, pushing the updates down to lower levels lazily. The key idea is that when a page is updated, multiple updates are applied together, reducing the number of page writes per update.</li>
<li>Another approach creates multiple trees and merges them; the log-structured merge tree and its variants are based on this idea.</li>
</ol>
</li>
</ul>
<h3 id="14-4-7-Indexing-in-Main-Memory"><a href="#14-4-7-Indexing-in-Main-Memory" class="headerlink" title="14.4.7 Indexing in Main Memory"></a>14.4.7 Indexing in Main Memory</h3><p>Optimization when B+-tree is used to index in-memory data:</p>
<ol>
<li>Since memory is costlier than disk, reduce memory size with techniques in Ch14.4.1</li>
<li>Cost of I/O is small, thus the tree struture can be relatively deep.</li>
<li>Speed difference between cache memory and main memory (1 or 2 nanoseconds in cache, while 50 to 100 nanoseconds from main memory): data are transferred in units of <em>cache-line</em> (typically 64 bytes). B + -trees with small nodes that ﬁt in a cache line have been found to provide very good performance with in-memory data, with less cache miss than tall, skinny treelike binary tree and B+-tree with larger nodes.</li>
<li>For both memory and disk performance: Large nodes are used to optimize disk-based access, but instead of treating data in a node as single large array of keys and pointers, the data within a node are structured as a tree, with smaller nodes that match the size of a cache line.</li>
</ol>
<h2 id="14-5-Hash-Indices"><a href="#14-5-Hash-Indices" class="headerlink" title="14.5 Hash Indices"></a>14.5 Hash Indices</h2><p>Hashing is a widely used technique for building indices in main memory; hash ﬁle organizations are not very widely used.</p>
<p><strong>overﬂow chaining</strong> Hash indexing using overﬂow chaining is also called <strong>closed addressing</strong> (or, less commonly, closed hashing).</p>
<p>:star: An alternative hashing scheme called open addressing is used in some applications, but is not suitable for most database indexing applications since open addressing does not support deletes eﬃciently.</p>
<p>Hash index support equality query, but don’t support range query.</p>
<p><strong>Static hashing</strong>: # buckets is fixed</p>
<p><strong>Dynamic hashing</strong> Ch24.5</p>
<h2 id="14-6-Multiple-Key-Access"><a href="#14-6-Multiple-Key-Access" class="headerlink" title="14.6 Multiple-Key Access"></a>14.6 Multiple-Key Access</h2><h3 id="14-6-1-Using-Multiple-Single-Key-indices"><a href="#14-6-1-Using-Multiple-Single-Key-indices" class="headerlink" title="14.6.1 Using Multiple Single-Key indices"></a>14.6.1 Using Multiple Single-Key indices</h3><p>Equality query on 2 indices, optimal strategy is to do 2 separate equality queries and take the intersection of 2 result sets.</p>
<p>However, it maybe a poor choice if all of the following holds</p>
<ol>
<li>Too many records on both separate equality query results.</li>
<li>Intersections are small.</li>
</ol>
<p>Bitmap index can sometimes greatly speed up such intersection.</p>
<h3 id="14-6-2-Indices-on-Multiple-Keys"><a href="#14-6-2-Indices-on-Multiple-Keys" class="headerlink" title="14.6.2 Indices on Multiple Keys"></a>14.6.2 Indices on Multiple Keys</h3><p>An alternative is to combine those 2 attributes into one index.</p>
<p>Shortcoming when query on first attribute is not equality.</p>
<p><em>R-tree</em> can be used to handle indexing on multiple dimensions and is discussed in Ch 14.10.1.</p>
<h3 id="14-6-3-Covering-Indices"><a href="#14-6-3-Covering-Indices" class="headerlink" title="14.6.3 Covering Indices"></a>14.6.3 Covering Indices</h3><p><strong>Covering indices</strong> are indices that store the values of some attributes (other than the search-key attributes) along with the pointers to the record. Storing extra attribute values is useful with secondary indices, since they allow us to answer some queries using just the index, without even looking up the actual records.</p>
<h2 id="14-8-Write-Optimized-Index-Structures"><a href="#14-8-Write-Optimized-Index-Structures" class="headerlink" title="14.8 Write-Optimized Index Structures"></a>14.8 Write-Optimized Index Structures</h2><p>Now suppose writes or inserts are done in an order that does not match the sort order of the index. Then, each write/insert is likely to touch a diﬀerent leaf node; if the number of leaf nodes is signiﬁcantly larger than the buﬀer size, most of these leaf accesses would require a random read operation, as well as a subsequent write operation to write the updated leaf page back to disk.</p>
<p>For flash based SSD, though random I/O is faster, each page write still has a significant cost for page earse. Thus the basic B+-tree structure is not ideal for applications with a very large number of random writes/inserts per second.</p>
<h3 id="14-8-1-LSM-Trees"><a href="#14-8-1-LSM-Trees" class="headerlink" title="14.8.1 LSM Trees"></a>14.8.1 LSM Trees</h3><p>in-memory tree $L_0$, on-disk trees $L_1,…,L_k$, where $k$ is called the level.</p>
<p><strong>Insertion</strong></p>
<ol>
<li>$L_0$ not full, insert in $L_0$</li>
<li>Else, flush to $L_1$ on disk<ol>
<li>$L_1$ is empty: $L_0$ is written to disk to create the initial $L_1$</li>
<li>Else: scan leaf nodes of both $L_0, L_1$ in increasing key order, and merge them where a new B+-tree is created on those merged entries from a bottom-up build process. The new $L_1$ replaces the old one.</li>
</ol>
</li>
</ol>
<ul>
<li>Benefits<ul>
<li>Leaves of the new tree are sequentially located, avoiding random I/O during subsequent merges.</li>
<li>Leaves are full, avoiding the overhead of partially occupied leaves that can occur with page splits.</li>
</ul>
</li>
<li>If only $L_1$, each time entire content is copied to merge with $L_0$. To reduce the cost:<ul>
<li>Multiple level: $k&gt;1$</li>
<li><strong>Stepped-merge index</strong>: Each level can have up to $b&gt;1$ trees.<ul>
<li>It reduces the insert cost, but increases query cost, since multiple trees need to be searched.</li>
<li>Solution: Bitmap-based structures called <strong>Bloom ﬁlters</strong> (Ch24.1), are used to reduce the number of lookups by eﬃciently detecting that a search key is not present in a particular tree. Bloom ﬁlters occupy very little space, but they are quite eﬀective at reducing query cost.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Deletion</strong></p>
<p>Instead of direct deletion, insert a new <strong>deletion entry</strong>:</p>
<ul>
<li>Lookup: among merged records, if there are both an index entry and a delete entry of the same key, they are filtered out and not returned as the result.</li>
<li>Merge: When trees are merged, index entry and delete entry with same key value are both discarded.</li>
</ul>
<p><strong>Update</strong></p>
<p>Similar to delete, insert a new <strong>update entry</strong>. Lookup return the latest value, and merge applies the updates and discard update entries.</p>
<p><strong>Design purpose</strong></p>
<p>LSM trees were initially designed to reduce the write and seek overheads of magnetic disks. The beneﬁt of avoiding random I/O that LSM tree variants provide is not particularly important with SSDs.</p>
<p>However, recall that ﬂash memory does not allow in-place update, and writing even a single byte to a page requires the whole page to be rewritten to a new physical location; the original location of the page needs to be erased eventually, which is a relatively expensive operation. <strong>The reduction in number of writes using LSM tree variants</strong>, as compared to traditional B + -trees, can provide substantial performance beneﬁts when LSM trees are used with SSDs.</p>
<p>A variant of the LSM tree similar to the stepped-merge index, with multiple trees in each layer, was used in Google’s BigTable system, as well as in Apache HBase, the open source clone of BigTable. These systems are built on top of distributed ﬁle systems that <em>allow appends</em> to ﬁles but <em>do not support updates</em> to existing data. The fact that LSM trees <strong>do not perform in-place update</strong> made LSM trees a very good ﬁt for these systems.</p>
<h3 id="14-8-2-Buffer-Tree"><a href="#14-8-2-Buffer-Tree" class="headerlink" title="14.8.2 Buffer Tree"></a>14.8.2 Buffer Tree</h3><p>The key idea behind the buﬀer tree is to associate a buﬀer with each internal node (including root) of a B+-tree.</p>
<p><img src="https://s2.loli.net/2021/12/09/iSuQFqBr74lIvjh.png" alt="image.png"></p>
<p>Insertion doesn’t traverse to the leaf, but insert in the buffer. When buffer is full, push each index record one level down the tree, recursively.</p>
<p>Lookup requires chekcing on buffer. Delete and update are similar to LSM.</p>
<p>Buffer tree have better worst-case complexity bounds on # I/O operations, faster read cost than LSM. But write involve random I/O, requiring more seeks.</p>
<p>However, since random I/O operations are very eﬃcient on SSDs, and buﬀer trees tend to perform fewer write operations overall compared to LSM trees, buﬀer trees can provide better write performance on SSDs. Several index structures designed for ﬂash storage make use of the buﬀer concept introduced by buﬀer trees.</p>
<p>Another beneﬁt of buﬀer trees is that the key idea of associating buﬀers with internal nodes, to reduce the number of writes, can be used with any type of tree-structured index. For example, buﬀering has been used as a way of supporting bulk loading of spatial indices such as R-trees (which we study in Section 14.10.1)</p>
<h2 id="14-9-Bitmap-Indices"><a href="#14-9-Bitmap-Indices" class="headerlink" title="14.9 Bitmap Indices"></a>14.9 Bitmap Indices</h2><ul>
<li>Sequential record number or block number.</li>
<li>Discrete attribute, or break up consecutive attribute into multiple levels.</li>
<li>Each value of attribute has a bitmap, indicating whether it has the value.</li>
</ul>
<h2 id="14-10-Indexing-of-Spatial-and-Temporal-Data"><a href="#14-10-Indexing-of-Spatial-and-Temporal-Data" class="headerlink" title="14.10 Indexing of Spatial and Temporal Data"></a>14.10 Indexing of Spatial and Temporal Data</h2><h3 id="14-10-1-Indexing-of-Spatail-Data"><a href="#14-10-1-Indexing-of-Spatail-Data" class="headerlink" title="14.10.1 Indexing of Spatail Data"></a>14.10.1 Indexing of Spatail Data</h3><p><strong>Spatial data</strong> refers to data referring to a point (e.g., (latitude, longitude)) or a region (e.g., identified by a polygon, with each corner’s (latitude, longitude)) in two or higher dimensional space.</p>
<p>Query:</p>
<ul>
<li><strong>range queries</strong>: specified area (multi dimensional)</li>
<li><strong>nearest neighbor query</strong></li>
</ul>
<p><strong>k-d Tree</strong>, <strong>k-d-B Tree</strong>, <strong>R-tree</strong></p>
<h3 id="14-10-2-Indexing-Temporal-Data"><a href="#14-10-2-Indexing-Temporal-Data" class="headerlink" title="14.10.2 Indexing Temporal Data"></a>14.10.2 Indexing Temporal Data</h3><p>time interval.</p>
<p><strong>interval B+tree</strong></p>

      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div>If it helps, you may buy me a cup of coffee plz.</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.jpg" alt="Virgil Sun WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/alipay.jpg" alt="Virgil Sun Alipay"/>
        <p>Alipay</p>
      </div>
    

  </div>
</div>

      </div>
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Virgil</li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    
    <a href="https://www.virgilsun.com/Notes%20on%20Database%20System%20Concepts%20-%20Ch14%20Indexing/" title="Notes on Database System Concepts - Ch14 Indexing">https://www.virgilsun.com/Notes%20on%20Database%20System%20Concepts%20-%20Ch14%20Indexing/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Indexing/" rel="tag"># Indexing</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
            
              <div id="needsharebutton-postbottom">
                <span class="btn">
                  <i class="fa fa-share-alt" aria-hidden="true"></i>
                </span>
              </div>
            
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Notes%20on%20Rebalancing%20in%20the%20Lightning%20Network/" rel="next" title="Notes on Rebalancing in the Lightning Network">
                <i class="fa fa-chevron-left"></i> Notes on Rebalancing in the Lightning Network
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Notes%20on%20Database%20System%20Concepts%20-%20Ch13%20Storage/" rel="prev" title="Notes on Database System Concepts - Ch13">
                Notes on Database System Concepts - Ch13 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
        <div id="lv-container" data-id="city" data-uid="MTAyMC80MzU0NS8yMDA4NA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://i.loli.net/2019/04/02/5ca34b140d93c.jpg"
                alt="Virgil Sun"/>
            
              <p class="site-author-name" itemprop="name">Virgil Sun</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/%20%7C%7C%20archive">
                
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">26</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                </span>
                  
                    
                  
                  <a href="https://github.com/SwJay" title="GitHub &rarr; https://github.com/SwJay" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                </span><br/>
                  
                    
                  
                  <a href="mailto:virgilsun@outlook.com" title="Mail &rarr; mailto:virgilsun@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                </span>
                  
                    
                  
                  <a href="https://www.weibo.com/u/1960293815" title="微博 &rarr; https://www.weibo.com/u/1960293815" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>微博</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                </span>
                  
                    
                  
                  <a href="/atom.xml" title="RSS &rarr; /atom.xml"><i class="fa fa-fw fa-fas fa-rss"></i>RSS</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.drg1998.cn/" title="https://blog.drg1998.cn/" rel="noopener" target="_blank">Guo Shuai</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Ch14-Indexing"><span class="nav-number">1.</span> <span class="nav-text">Ch14 Indexing</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#14-1-Basic-Concepts"><span class="nav-number">1.1.</span> <span class="nav-text">14.1 Basic Concepts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-2-Ordered-Indices"><span class="nav-number">1.2.</span> <span class="nav-text">14.2 Ordered Indices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-1-Dense-and-Sparse-Indices"><span class="nav-number">1.2.1.</span> <span class="nav-text">14.2.1 Dense and Sparse Indices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-2-Multilevel-Indices"><span class="nav-number">1.2.2.</span> <span class="nav-text">14.2.2 Multilevel Indices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-3-Index-Update"><span class="nav-number">1.2.3.</span> <span class="nav-text">14.2.3 Index Update</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#14-2-3-1-Insertion"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">14.2.3.1 Insertion</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-2-3-2-Deletion"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">14.2.3.2 Deletion</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-4-Secondary-Indices"><span class="nav-number">1.2.4.</span> <span class="nav-text">14.2.4 Secondary Indices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-5-Indices-on-Multiple-Keys"><span class="nav-number">1.2.5.</span> <span class="nav-text">14.2.5 Indices on Multiple Keys</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-3-B-Tree-Index-Files"><span class="nav-number">1.3.</span> <span class="nav-text">14.3 B+-Tree Index Files</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-3-1-Structure-of-a-B-Tree"><span class="nav-number">1.3.1.</span> <span class="nav-text">14.3.1 Structure of a B+-Tree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-3-2-Queries-on-B-Trees"><span class="nav-number">1.3.2.</span> <span class="nav-text">14.3.2 Queries on B+-Trees</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-3-3-Updates-on-B-Trees"><span class="nav-number">1.3.3.</span> <span class="nav-text">14.3.3 Updates on B+-Trees</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#14-3-3-1-Insertion"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">14.3.3.1 Insertion</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-3-32-Deletion"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">14.3.32 Deletion</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-3-4-Complexity-of-B-Tree-Updates"><span class="nav-number">1.3.4.</span> <span class="nav-text">14.3.4 Complexity of B+-Tree Updates</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-4-B-Tree-Extensions"><span class="nav-number">1.4.</span> <span class="nav-text">14.4 B+-Tree Extensions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-1-B-Tree-File-Organization"><span class="nav-number">1.4.1.</span> <span class="nav-text">14.4.1 B+-Tree File Organization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-2-Secondary-Indices-and-Record-Relocation"><span class="nav-number">1.4.2.</span> <span class="nav-text">14.4.2 Secondary Indices and Record Relocation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-3-Indexing-Strings"><span class="nav-number">1.4.3.</span> <span class="nav-text">14.4.3 Indexing Strings</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-4-Bulk-Loading-of-B-Tree-Indices"><span class="nav-number">1.4.4.</span> <span class="nav-text">14.4.4 Bulk Loading of B+-Tree Indices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-6-Indexing-on-Flash-Storage"><span class="nav-number">1.4.5.</span> <span class="nav-text">14.4.6 Indexing on Flash Storage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-7-Indexing-in-Main-Memory"><span class="nav-number">1.4.6.</span> <span class="nav-text">14.4.7 Indexing in Main Memory</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-5-Hash-Indices"><span class="nav-number">1.5.</span> <span class="nav-text">14.5 Hash Indices</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-6-Multiple-Key-Access"><span class="nav-number">1.6.</span> <span class="nav-text">14.6 Multiple-Key Access</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-6-1-Using-Multiple-Single-Key-indices"><span class="nav-number">1.6.1.</span> <span class="nav-text">14.6.1 Using Multiple Single-Key indices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-6-2-Indices-on-Multiple-Keys"><span class="nav-number">1.6.2.</span> <span class="nav-text">14.6.2 Indices on Multiple Keys</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-6-3-Covering-Indices"><span class="nav-number">1.6.3.</span> <span class="nav-text">14.6.3 Covering Indices</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-8-Write-Optimized-Index-Structures"><span class="nav-number">1.7.</span> <span class="nav-text">14.8 Write-Optimized Index Structures</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-8-1-LSM-Trees"><span class="nav-number">1.7.1.</span> <span class="nav-text">14.8.1 LSM Trees</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-8-2-Buffer-Tree"><span class="nav-number">1.7.2.</span> <span class="nav-text">14.8.2 Buffer Tree</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-9-Bitmap-Indices"><span class="nav-number">1.8.</span> <span class="nav-text">14.9 Bitmap Indices</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-10-Indexing-of-Spatial-and-Temporal-Data"><span class="nav-number">1.9.</span> <span class="nav-text">14.10 Indexing of Spatial and Temporal Data</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-10-1-Indexing-of-Spatail-Data"><span class="nav-number">1.9.1.</span> <span class="nav-text">14.10.1 Indexing of Spatail Data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-10-2-Indexing-Temporal-Data"><span class="nav-number">1.9.2.</span> <span class="nav-text">14.10.2 Indexing Temporal Data</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Virgil Sun</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v5.4.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.1</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="Total Views">
      已有
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次到访 w
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  















  
  <script src="//cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery_lazyload@1.9.3/jquery.lazyload.min.js"></script>

  
  <script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.2.1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1.2.1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fancybox@3.0.0/dist/js/jquery.fancybox.pack.js"></script>


  


  <script src="/js/utils.js?v=7.0.1"></script>

  <script src="/js/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.0.1"></script>



  
  <script src="/js/scrollspy.js?v=7.0.1"></script>
<script src="/js/post-details.js?v=7.0.1"></script>



  


  <script src="/js/next-boot.js?v=7.0.1"></script>


  

  

  

  


  
    <script>
  window.livereOptions = {
    refer: 'Notes on Database System Concepts - Ch14 Indexing/'
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  
    
  
  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });
  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling }
        if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next) }
      }
    });
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
    }
  });
</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

    
  


  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script>
  <script>
    
      pbOptions = {};
      
        pbOptions.iconStyle = "box";
      
        pbOptions.boxForm = "horizontal";
      
        pbOptions.position = "bottomCenter";
      
        pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>


  

  

  

  

  

  


  
</body>
</html>
